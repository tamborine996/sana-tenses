<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tenses Practice</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,400;0,500;0,600;1,400&family=Noto+Nastaliq+Urdu:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --cream: #faf7f2;
            --cream-dark: #f0ebe3;
            --ink: #1a2a2d;
            --ink-light: #3d4f52;
            --teal: #2d5a5a;
            --teal-deep: #1a4a4a;
            --amber: #c9982c;
            --amber-light: #e8c76b;
            --rose: #a85a5a;
            --rose-light: #d4a0a0;
            --sage: #7a9a8a;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            font-size: 16px;
        }

        body {
            font-family: 'Cormorant Garamond', Georgia, serif;
            background: var(--cream);
            background-image:
                radial-gradient(ellipse at 20% 20%, rgba(45, 90, 90, 0.03) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 80%, rgba(201, 152, 44, 0.04) 0%, transparent 50%),
                url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.85' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%' height='100%' filter='url(%23noise)'/%3E%3C/svg%3E");
            background-blend-mode: normal, normal, overlay;
            min-height: 100vh;
            min-height: 100dvh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 24px 20px;
            color: var(--ink);
        }

        /* Header */
        .header {
            text-align: center;
            margin-bottom: 24px;
            animation: fadeDown 0.6s ease-out;
        }

        @keyframes fadeDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .header h1 {
            font-size: 1.75rem;
            font-weight: 500;
            color: var(--teal-deep);
            letter-spacing: 0.08em;
            text-transform: uppercase;
            margin-bottom: 8px;
        }

        .stats {
            font-size: 0.95rem;
            color: var(--ink-light);
            font-weight: 400;
            letter-spacing: 0.03em;
        }

        .stats span {
            font-weight: 500;
        }

        .divider {
            display: inline-block;
            width: 1px;
            height: 12px;
            background: var(--ink-light);
            opacity: 0.3;
            margin: 0 12px;
            vertical-align: middle;
        }

        /* Category Filters */
        .category-filter {
            margin-bottom: 28px;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            justify-content: center;
            max-width: 520px;
            animation: fadeDown 0.6s ease-out 0.1s backwards;
        }

        .filter-btn {
            padding: 8px 16px;
            border: 1px solid var(--teal);
            background: transparent;
            border-radius: 2px;
            font-family: 'Cormorant Garamond', Georgia, serif;
            font-size: 0.85rem;
            font-weight: 500;
            letter-spacing: 0.04em;
            color: var(--teal);
            cursor: pointer;
            transition: all 0.25s ease;
        }

        .filter-btn:hover {
            background: rgba(45, 90, 90, 0.08);
        }

        .filter-btn.active {
            background: var(--teal);
            color: var(--cream);
            border-color: var(--teal);
        }

        /* Card Container */
        .card-container {
            width: 100%;
            max-width: 480px;
            animation: fadeUp 0.6s ease-out 0.2s backwards;
        }

        @keyframes fadeUp {
            from {
                opacity: 0;
                transform: translateY(15px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Card */
        .card {
            background: linear-gradient(145deg, #ffffff 0%, var(--cream) 100%);
            border: 1px solid rgba(26, 42, 45, 0.08);
            border-radius: 4px;
            padding: 36px 28px;
            min-height: 300px;
            display: flex;
            flex-direction: column;
            cursor: pointer;
            position: relative;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            box-shadow:
                0 1px 2px rgba(26, 42, 45, 0.04),
                0 4px 12px rgba(26, 42, 45, 0.06),
                0 12px 24px rgba(26, 42, 45, 0.04);
        }

        .card::before {
            content: '';
            position: absolute;
            top: 8px;
            left: 8px;
            right: 8px;
            bottom: 8px;
            border: 1px solid rgba(201, 152, 44, 0.15);
            border-radius: 2px;
            pointer-events: none;
        }

        .card:hover:not(.revealed) {
            transform: translateY(-2px);
            box-shadow:
                0 2px 4px rgba(26, 42, 45, 0.04),
                0 8px 20px rgba(26, 42, 45, 0.08),
                0 16px 32px rgba(26, 42, 45, 0.06);
        }

        .card.revealed {
            cursor: default;
        }

        /* Situation / Urdu Text */
        .situation {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 12px 0;
        }

        .urdu-text {
            font-family: 'Noto Nastaliq Urdu', serif;
            font-size: 1.5rem;
            font-weight: 500;
            line-height: 2.2;
            direction: rtl;
            color: var(--ink);
            transition: opacity 0.3s ease;
        }

        .card.revealed .urdu-text {
            opacity: 0.7;
        }

        /* Answer Section */
        .answer-section {
            margin-top: 24px;
            padding-top: 24px;
            border-top: 1px solid rgba(201, 152, 44, 0.3);
            opacity: 0;
            transform: translateY(10px);
            pointer-events: none;
            transition: opacity 0.4s ease, transform 0.4s ease;
        }

        .answer-section.visible {
            opacity: 1;
            transform: translateY(0);
            pointer-events: auto;
        }

        .english-answer {
            font-size: 1.4rem;
            font-weight: 500;
            font-style: italic;
            color: var(--teal-deep);
            text-align: center;
            margin-bottom: 16px;
            line-height: 1.5;
        }

        .tense-label-container {
            text-align: center;
            margin-bottom: 16px;
        }

        .tense-label {
            font-size: 0.75rem;
            font-weight: 600;
            letter-spacing: 0.12em;
            text-transform: uppercase;
            color: var(--amber);
            background: rgba(201, 152, 44, 0.12);
            padding: 6px 14px;
            border-radius: 2px;
            display: inline-block;
        }

        .explanation {
            font-family: 'Noto Nastaliq Urdu', serif;
            font-size: 1rem;
            color: var(--ink-light);
            text-align: center;
            direction: rtl;
            line-height: 2;
            opacity: 0.85;
        }

        /* Tap Hint */
        .tap-hint {
            text-align: center;
            color: var(--ink-light);
            font-size: 0.85rem;
            font-style: italic;
            margin-top: 20px;
            opacity: 0.6;
            transition: opacity 0.3s ease;
        }

        .card:hover .tap-hint {
            opacity: 1;
        }

        /* Buttons */
        .buttons {
            display: flex;
            gap: 12px;
            margin-top: 24px;
            opacity: 0;
            transform: translateY(10px);
            pointer-events: none;
            transition: opacity 0.4s ease 0.1s, transform 0.4s ease 0.1s;
        }

        .buttons.visible {
            opacity: 1;
            transform: translateY(0);
            pointer-events: auto;
        }

        .btn {
            flex: 1;
            padding: 14px 20px;
            border: none;
            border-radius: 2px;
            font-family: 'Cormorant Garamond', Georgia, serif;
            font-size: 0.95rem;
            font-weight: 600;
            letter-spacing: 0.06em;
            cursor: pointer;
            transition: all 0.25s ease;
        }

        .btn-wrong {
            background: rgba(168, 90, 90, 0.1);
            color: var(--rose);
            border: 1px solid var(--rose-light);
        }

        .btn-wrong:hover {
            background: var(--rose);
            color: var(--cream);
            border-color: var(--rose);
        }

        .btn-right {
            background: var(--amber);
            color: var(--ink);
            border: 1px solid var(--amber);
        }

        .btn-right:hover {
            background: var(--amber-light);
            border-color: var(--amber-light);
        }

        /* Progress Bar */
        .progress-bar {
            width: 100%;
            max-width: 480px;
            height: 3px;
            background: rgba(26, 42, 45, 0.1);
            border-radius: 2px;
            margin-top: 28px;
            overflow: hidden;
            animation: fadeUp 0.6s ease-out 0.3s backwards;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--teal) 0%, var(--sage) 100%);
            transition: width 0.4s ease;
            border-radius: 2px;
        }

        /* Session Complete */
        .session-complete {
            text-align: center;
            padding: 40px 20px;
        }

        .session-complete h2 {
            font-size: 1.5rem;
            font-weight: 500;
            color: var(--teal-deep);
            margin-bottom: 12px;
            letter-spacing: 0.04em;
        }

        .session-complete p {
            color: var(--ink-light);
            margin-bottom: 28px;
            font-size: 1.05rem;
        }

        .btn-restart {
            background: var(--teal);
            color: var(--cream);
            padding: 14px 36px;
            border: 1px solid var(--teal);
        }

        .btn-restart:hover {
            background: var(--teal-deep);
            border-color: var(--teal-deep);
        }

        /* Decorative Elements */
        .ornament {
            width: 40px;
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--amber), transparent);
            margin: 0 auto 20px;
            opacity: 0.6;
        }

        /* Mobile Adjustments */
        @media (max-width: 480px) {
            body {
                padding: 20px 16px;
            }

            .header h1 {
                font-size: 1.5rem;
            }

            .card {
                padding: 28px 20px;
                min-height: 280px;
            }

            .urdu-text {
                font-size: 1.35rem;
            }

            .english-answer {
                font-size: 1.25rem;
            }

            .filter-btn {
                padding: 6px 12px;
                font-size: 0.8rem;
            }

            .btn {
                padding: 12px 16px;
                font-size: 0.9rem;
            }
        }

        /* Dark mode support */
        @media (prefers-color-scheme: dark) {
            :root {
                --cream: #1a1a1a;
                --cream-dark: #252525;
                --ink: #e8e4df;
                --ink-light: #a8a4a0;
                --teal: #5a9a9a;
                --teal-deep: #6aacac;
                --amber: #d4a842;
                --amber-light: #e8c76b;
                --rose: #c87a7a;
                --rose-light: #a86a6a;
            }

            body {
                background: var(--cream);
                background-image:
                    radial-gradient(ellipse at 20% 20%, rgba(90, 154, 154, 0.06) 0%, transparent 50%),
                    radial-gradient(ellipse at 80% 80%, rgba(212, 168, 66, 0.04) 0%, transparent 50%);
            }

            .card {
                background: linear-gradient(145deg, #222222 0%, #1a1a1a 100%);
                border-color: rgba(255, 255, 255, 0.06);
                box-shadow:
                    0 1px 2px rgba(0, 0, 0, 0.2),
                    0 4px 12px rgba(0, 0, 0, 0.25),
                    0 12px 24px rgba(0, 0, 0, 0.2);
            }

            .card::before {
                border-color: rgba(212, 168, 66, 0.1);
            }

            .progress-bar {
                background: rgba(255, 255, 255, 0.08);
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Tenses</h1>
        <div class="ornament"></div>
        <div class="stats">
            <span id="current">1</span> / <span id="total">0</span>
            <span class="divider"></span>
            Review: <span id="review-count">0</span>
        </div>
    </div>

    <div class="category-filter" id="filters"></div>

    <div class="card-container">
        <div class="card" id="card">
            <div class="situation">
                <div class="urdu-text" id="urdu"></div>
            </div>
            <div class="answer-section" id="answer-section">
                <div class="english-answer" id="english"></div>
                <div class="tense-label-container">
                    <span class="tense-label" id="tense-label"></span>
                </div>
                <div class="explanation" id="explanation"></div>
            </div>
            <div class="tap-hint" id="tap-hint">tap to reveal</div>
            <div class="buttons" id="buttons">
                <button class="btn btn-wrong" id="btn-wrong">Review Again</button>
                <button class="btn btn-right" id="btn-right">Got It</button>
            </div>
        </div>
    </div>

    <div class="progress-bar">
        <div class="progress-fill" id="progress"></div>
    </div>

    <script>
        // Situation bank - organized by tense category
        const situations = [
            // PRESENT PERFECT vs PAST SIMPLE (the big one for Urdu speakers)
            {
                urdu: "آپ اپنی سہیلی کو بتانا چاہتی ہیں کہ آپ نے ابھی ابھی کھانا ختم کیا ہے",
                context: "You just finished eating moments ago",
                english: "I have just finished eating.",
                tense: "Present Perfect",
                explanation: "ابھی ابھی ہونے والے کام کے لیے present perfect استعمال ہوتا ہے",
                category: "present-perfect"
            },
            {
                urdu: "آپ بتانا چاہتی ہیں کہ آپ نے کل یہ فلم دیکھی",
                context: "You watched a movie yesterday",
                english: "I watched this movie yesterday.",
                tense: "Past Simple",
                explanation: "کل - مخصوص وقت ماضی میں، اس لیے past simple",
                category: "past-simple"
            },
            {
                urdu: "آپ بتانا چاہتی ہیں کہ آپ نے یہ فلم دیکھی ہے",
                context: "You have seen this movie (at some point in your life)",
                english: "I have seen this movie.",
                tense: "Present Perfect",
                explanation: "زندگی میں کبھی - وقت نہیں بتایا، تجربہ بتایا، present perfect",
                category: "present-perfect"
            },
            {
                urdu: "آپ بتانا چاہتی ہیں کہ وہ پاکستان گئے ہیں",
                context: "They have gone to Pakistan (they're still there)",
                english: "They have gone to Pakistan.",
                tense: "Present Perfect",
                explanation: "ابھی تک وہاں ہیں - نتیجہ ابھی موجود ہے، present perfect",
                category: "present-perfect"
            },
            {
                urdu: "آپ بتانا چاہتی ہیں کہ وہ پچھلے سال پاکستان گئے تھے",
                context: "They went to Pakistan last year",
                english: "They went to Pakistan last year.",
                tense: "Past Simple",
                explanation: "پچھلے سال - مخصوص وقت ماضی میں، past simple",
                category: "past-simple"
            },
            {
                urdu: "آپ پوچھنا چاہتی ہیں کہ کیا اس نے ناشتہ کیا ہے",
                context: "Asking if someone has had breakfast (relevant now)",
                english: "Have you had breakfast?",
                tense: "Present Perfect",
                explanation: "ابھی متعلق ہے - کیا ناشتہ کیا یا نہیں، present perfect",
                category: "present-perfect"
            },
            {
                urdu: "آپ پوچھنا چاہتی ہیں کہ اس نے کل ناشتہ کیا یا نہیں",
                context: "Asking about breakfast yesterday specifically",
                english: "Did you have breakfast yesterday?",
                tense: "Past Simple",
                explanation: "کل کے بارے میں پوچھ رہی ہیں - مخصوص وقت، past simple",
                category: "past-simple"
            },
            {
                urdu: "میں نے اپنا فون کھو دیا ہے",
                context: "You lost your phone and still don't have it",
                english: "I have lost my phone.",
                tense: "Present Perfect",
                explanation: "ابھی بھی نہیں ملا - نتیجہ ابھی موجود ہے، present perfect",
                category: "present-perfect"
            },
            {
                urdu: "میں نے پچھلے ہفتے اپنا فون کھویا تھا لیکن مل گیا",
                context: "You lost your phone last week but found it",
                english: "I lost my phone last week but I found it.",
                tense: "Past Simple",
                explanation: "ختم شدہ واقعہ ماضی میں، past simple",
                category: "past-simple"
            },

            // PRESENT CONTINUOUS vs PRESENT SIMPLE
            {
                urdu: "آپ بتانا چاہتی ہیں کہ آپ ابھی کھانا پکا رہی ہیں",
                context: "You are cooking right now",
                english: "I am cooking right now.",
                tense: "Present Continuous",
                explanation: "ابھی اس وقت ہو رہا ہے - present continuous",
                category: "present-continuous"
            },
            {
                urdu: "آپ بتانا چاہتی ہیں کہ آپ روزانہ کھانا پکاتی ہیں",
                context: "You cook every day (routine)",
                english: "I cook every day.",
                tense: "Present Simple",
                explanation: "روزانہ کا معمول - present simple",
                category: "present-simple"
            },
            {
                urdu: "بچے باہر کھیل رہے ہیں",
                context: "The children are playing outside right now",
                english: "The children are playing outside.",
                tense: "Present Continuous",
                explanation: "ابھی ہو رہا ہے - present continuous",
                category: "present-continuous"
            },
            {
                urdu: "بچے ہر روز باہر کھیلتے ہیں",
                context: "The children play outside every day",
                english: "The children play outside every day.",
                tense: "Present Simple",
                explanation: "ہر روز - عادت، present simple",
                category: "present-simple"
            },
            {
                urdu: "وہ اس وقت ٹی وی دیکھ رہا ہے",
                context: "He is watching TV at this moment",
                english: "He is watching TV right now.",
                tense: "Present Continuous",
                explanation: "اس وقت - ابھی ہو رہا ہے، present continuous",
                category: "present-continuous"
            },
            {
                urdu: "وہ ہر شام ٹی وی دیکھتا ہے",
                context: "He watches TV every evening (habit)",
                english: "He watches TV every evening.",
                tense: "Present Simple",
                explanation: "ہر شام - عادت/معمول، present simple",
                category: "present-simple"
            },

            // PRESENT PERFECT CONTINUOUS
            {
                urdu: "آپ بتانا چاہتی ہیں کہ آپ دو گھنٹے سے پڑھ رہی ہیں",
                context: "You started studying 2 hours ago and are still studying",
                english: "I have been studying for two hours.",
                tense: "Present Perfect Continuous",
                explanation: "دو گھنٹے سے جاری ہے اور ابھی بھی ہو رہا ہے - present perfect continuous",
                category: "present-perfect-continuous"
            },
            {
                urdu: "بارش صبح سے ہو رہی ہے",
                context: "It started raining in the morning and is still raining",
                english: "It has been raining since morning.",
                tense: "Present Perfect Continuous",
                explanation: "صبح سے شروع ہوئی اور ابھی تک جاری ہے - present perfect continuous",
                category: "present-perfect-continuous"
            },
            {
                urdu: "وہ تین سال سے یہاں کام کر رہی ہے",
                context: "She started working here 3 years ago and still works here",
                english: "She has been working here for three years.",
                tense: "Present Perfect Continuous",
                explanation: "تین سال سے جاری ہے - present perfect continuous",
                category: "present-perfect-continuous"
            },
            {
                urdu: "میں آدھے گھنٹے سے آپ کا انتظار کر رہی ہوں",
                context: "You've been waiting for half an hour and still waiting",
                english: "I have been waiting for you for half an hour.",
                tense: "Present Perfect Continuous",
                explanation: "آدھے گھنٹے سے انتظار جاری ہے - present perfect continuous",
                category: "present-perfect-continuous"
            },

            // PAST CONTINUOUS
            {
                urdu: "جب وہ آئی میں کھانا پکا رہی تھی",
                context: "She arrived while you were in the middle of cooking",
                english: "I was cooking when she arrived.",
                tense: "Past Continuous + Past Simple",
                explanation: "ایک کام جاری تھا (was cooking) جب دوسرا ہوا (arrived)",
                category: "past-continuous"
            },
            {
                urdu: "کل رات آٹھ بجے میں پڑھ رہی تھی",
                context: "At 8 PM last night, you were studying",
                english: "I was studying at 8 PM last night.",
                tense: "Past Continuous",
                explanation: "ماضی میں ایک خاص وقت پر کام جاری تھا - past continuous",
                category: "past-continuous"
            },
            {
                urdu: "جب فون آیا بچے سو رہے تھے",
                context: "The phone rang while the children were sleeping",
                english: "The children were sleeping when the phone rang.",
                tense: "Past Continuous + Past Simple",
                explanation: "سونا جاری تھا، فون کی گھنٹی بجی - past continuous + past simple",
                category: "past-continuous"
            },

            // FUTURE - WILL vs GOING TO
            {
                urdu: "آپ نے ابھی فیصلہ کیا کہ آپ چائے بنائیں گی",
                context: "You just decided this moment to make tea",
                english: "I will make some tea.",
                tense: "Future Simple (will)",
                explanation: "ابھی فیصلہ کیا - spontaneous decision، will استعمال ہوتا ہے",
                category: "future"
            },
            {
                urdu: "آپ کا پلان ہے کہ کل آپ ڈاکٹر کے پاس جائیں گی",
                context: "You already have a plan to see the doctor tomorrow",
                english: "I am going to see the doctor tomorrow.",
                tense: "Future (going to)",
                explanation: "پہلے سے پلان ہے - going to استعمال ہوتا ہے",
                category: "future"
            },
            {
                urdu: "آسمان پر کالے بادل ہیں۔ بارش ہونے والی ہے",
                context: "Dark clouds - rain is about to happen (evidence)",
                english: "It is going to rain.",
                tense: "Future (going to)",
                explanation: "نشانیاں موجود ہیں - going to",
                category: "future"
            },
            {
                urdu: "میں وعدہ کرتی ہوں کہ میں کل ضرور آؤں گی",
                context: "Making a promise",
                english: "I will definitely come tomorrow.",
                tense: "Future Simple (will)",
                explanation: "وعدہ کرنا - will استعمال ہوتا ہے",
                category: "future"
            },
            {
                urdu: "ہم اگلے ہفتے لاہور جا رہے ہیں - ٹکٹ لے لی ہیں",
                context: "Tickets already booked - fixed plan",
                english: "We are going to Lahore next week.",
                tense: "Present Continuous (for future)",
                explanation: "پکا پروگرام، تیاری ہو چکی ہے - present continuous بھی future کے لیے استعمال ہوتا ہے",
                category: "future"
            },

            // More PRESENT PERFECT vs PAST SIMPLE (common mistakes)
            {
                urdu: "میں نے آج صبح ناشتہ نہیں کیا",
                context: "You didn't have breakfast this morning (today is not over)",
                english: "I haven't had breakfast today.",
                tense: "Present Perfect",
                explanation: "آج ابھی ختم نہیں ہوا - present perfect",
                category: "present-perfect"
            },
            {
                urdu: "میں نے اس ہفتے تین فلمیں دیکھی ہیں",
                context: "This week (week is not over)",
                english: "I have watched three movies this week.",
                tense: "Present Perfect",
                explanation: "یہ ہفتہ ابھی جاری ہے - present perfect",
                category: "present-perfect"
            },
            {
                urdu: "پچھلے ہفتے میں نے تین فلمیں دیکھیں",
                context: "Last week (finished time period)",
                english: "I watched three movies last week.",
                tense: "Past Simple",
                explanation: "پچھلا ہفتہ ختم ہو گیا - past simple",
                category: "past-simple"
            },
            {
                urdu: "کیا تم نے کبھی سشی کھائی ہے؟",
                context: "Asking about life experience (ever)",
                english: "Have you ever eaten sushi?",
                tense: "Present Perfect",
                explanation: "کبھی - زندگی کا تجربہ - present perfect",
                category: "present-perfect"
            },
            {
                urdu: "ہاں میں نے جاپان میں سشی کھائی تھی",
                context: "Yes, when I was in Japan (specific past time)",
                english: "Yes, I ate sushi when I was in Japan.",
                tense: "Past Simple",
                explanation: "جاپان میں تھی - مخصوص وقت ماضی میں - past simple",
                category: "past-simple"
            },
        ];

        // State
        let currentSituations = [...situations];
        let currentIndex = 0;
        let reviewPile = [];
        let correctCount = 0;
        let revealed = false;
        let activeCategories = new Set(['all']);

        // DOM elements
        const card = document.getElementById('card');
        const urduEl = document.getElementById('urdu');
        const englishEl = document.getElementById('english');
        const tenseLabelEl = document.getElementById('tense-label');
        const explanationEl = document.getElementById('explanation');
        const answerSection = document.getElementById('answer-section');
        const tapHint = document.getElementById('tap-hint');
        const buttons = document.getElementById('buttons');
        const btnWrong = document.getElementById('btn-wrong');
        const btnRight = document.getElementById('btn-right');
        const currentEl = document.getElementById('current');
        const totalEl = document.getElementById('total');
        const reviewCountEl = document.getElementById('review-count');
        const progressEl = document.getElementById('progress');
        const filtersEl = document.getElementById('filters');

        // Categories for filtering
        const categories = {
            'all': 'All',
            'present-perfect': 'Present Perfect',
            'past-simple': 'Past Simple',
            'present-continuous': 'Present Continuous',
            'present-simple': 'Present Simple',
            'present-perfect-continuous': 'Perfect Continuous',
            'past-continuous': 'Past Continuous',
            'future': 'Future'
        };

        // Initialize filters
        function initFilters() {
            Object.entries(categories).forEach(([key, label]) => {
                const btn = document.createElement('button');
                btn.className = 'filter-btn' + (key === 'all' ? ' active' : '');
                btn.textContent = label;
                btn.onclick = () => toggleCategory(key);
                filtersEl.appendChild(btn);
            });
        }

        function toggleCategory(category) {
            const btn = [...filtersEl.children].find(b => b.textContent === categories[category]);

            if (category === 'all') {
                activeCategories = new Set(['all']);
                [...filtersEl.children].forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
            } else {
                activeCategories.delete('all');
                [...filtersEl.children][0].classList.remove('active');

                if (activeCategories.has(category)) {
                    activeCategories.delete(category);
                    btn.classList.remove('active');
                } else {
                    activeCategories.add(category);
                    btn.classList.add('active');
                }

                if (activeCategories.size === 0) {
                    activeCategories.add('all');
                    [...filtersEl.children][0].classList.add('active');
                }
            }

            resetDeck();
        }

        function filterSituations() {
            if (activeCategories.has('all')) {
                return [...situations];
            }
            return situations.filter(s => activeCategories.has(s.category));
        }

        function shuffle(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

        function resetDeck() {
            currentSituations = shuffle(filterSituations());
            currentIndex = 0;
            reviewPile = [];
            correctCount = 0;
            revealed = false;
            updateDisplay();
        }

        function updateDisplay() {
            if (currentIndex >= currentSituations.length) {
                if (reviewPile.length > 0) {
                    // Start review round
                    currentSituations = shuffle(reviewPile);
                    reviewPile = [];
                    currentIndex = 0;
                } else {
                    showComplete();
                    return;
                }
            }

            const situation = currentSituations[currentIndex];
            urduEl.textContent = situation.urdu;
            englishEl.textContent = situation.english;
            tenseLabelEl.textContent = situation.tense;
            explanationEl.textContent = situation.explanation;

            answerSection.classList.remove('visible');
            buttons.classList.remove('visible');
            tapHint.style.display = 'block';
            card.classList.remove('revealed');
            revealed = false;

            currentEl.textContent = currentIndex + 1;
            totalEl.textContent = currentSituations.length;
            reviewCountEl.textContent = reviewPile.length;

            const progress = (correctCount / situations.length) * 100;
            progressEl.style.width = progress + '%';
        }

        function revealAnswer() {
            if (revealed) return;
            revealed = true;
            card.classList.add('revealed');
            answerSection.classList.add('visible');
            buttons.classList.add('visible');
            tapHint.style.display = 'none';
        }

        function markWrong() {
            reviewPile.push(currentSituations[currentIndex]);
            currentIndex++;
            updateDisplay();
        }

        function markRight() {
            correctCount++;
            currentIndex++;
            updateDisplay();
        }

        function showComplete() {
            card.innerHTML = `
                <div class="session-complete">
                    <h2>Session Complete</h2>
                    <div class="ornament"></div>
                    <p>You practiced ${currentSituations.length} situations.</p>
                    <button class="btn btn-restart" onclick="location.reload();">Practice Again</button>
                </div>
            `;
        }

        // Event listeners
        card.addEventListener('click', (e) => {
            if (!revealed && !e.target.classList.contains('btn')) {
                revealAnswer();
            }
        });

        btnWrong.addEventListener('click', (e) => {
            e.stopPropagation();
            markWrong();
        });

        btnRight.addEventListener('click', (e) => {
            e.stopPropagation();
            markRight();
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.code === 'Space') {
                e.preventDefault();
                if (!revealed) {
                    revealAnswer();
                }
            } else if (e.code === 'ArrowLeft' && revealed) {
                markWrong();
            } else if (e.code === 'ArrowRight' && revealed) {
                markRight();
            }
        });

        // Initialize
        initFilters();
        resetDeck();
    </script>
</body>
</html>
